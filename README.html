<!DOCTYPE html>
<html>
<head>
<title>Step-By-Step Guide to Using Eleventy and GitHub Codespaces to Create GitHub Pages</title>
</head>

<body>
  <h1>All-In-One Guide to Using Eleventy and GitHub Codespaces to Create GitHub Pages</h1>
  <p>Modified from <a href="https://medium.com/@andresbitrian/eleventy-website-to-github-pages-with-github-actions-36bc48d3be09">Eleventy website to GitHub Pages with GitHub Actions</a> by Andres Lopez</p>
  <ol>
    <li>github.new</li>
    <li>Name repository eleventy-github</li>
    <li>Add a README file</li>
    <li>Click green "Create Repository" button</li>
    <li>Click the plus sign and select "New codespace", and select your new "eleventy-github" repository in the dropdown, then select the green "Create codespace" button OR Click the green "<>Code" dropdown and select the right "Codespaces" tab and the green "Create codespace on main" button</li>
    <li>Your codespace will open with Explorer to the left, Preview to the right, and Terminal at the bottom. You can toggle this view as needed with the icons in the top right</li>
    <li>In your Terminal, copy and paste $ npm init -y and hit enter. This will create a package.json file</li>
    <li>Next copy and paste  npm install @11ty/eleventy@latest sass@latest --save-exact and hit enter. This will install Eleventy, create a node_modules folder, and a package-lock.json file.</li>
    <li>In the Explorer, select the new package.json file.</li>
    <li>Highlight line 7, the "test" script and replace with the following (check indenting) 
      <code><pre>
        "watch:sass": "sass src/static/scss:public/static/css --watch",
        "build:sass": "sass src/static/scss:public/static/css",
        "watch:eleventy": "eleventy --serve",
        "build:eleventy": "ELEVENTY_ENV=development eleventy",
        "start": "npm run watch:eleventy & npm run watch:sass",
        "build": "npm run build:eleventy & npm run build:sass"
      </pre></code>
    </li>
    <li>Create a new "src" folder by clicking on the folder+ button in explorer</li>
    <li>Inside your new "src" folder create two subfolders: "_includes" and "static"</li>
    <li>Inside your new "static" folder, create a new "scss" folder</li>
    <li>Next create a new file ".eleventy.js" in the root directory with the following code: 
      <code><pre>module.exports = function (eleventyConfig) {
  eleventyConfig.setBrowserSyncConfig({
    files: './public/static/**/*.css',
  });

  return {
    dir: {
      input: 'src',
      output: 'public',
    },
  };
};
      </pre></code>
    </li>
    <li>Create an empty file named "main.scss" in the static/scss folder</li>
    <li>Create a template file named base.njk in the _includes folder</li>
    <li>Paste the following code in base.njk 
      <code><pre>
        <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{{ title }}</title>
  </head>
  <body>
    {% block content %} {{ content | safe }} {% endblock %}
  </body>
</html>
      </pre></code></li>
    <li>Create an index.md file in your src directory</li>
    <li>Paste the following code in your new "index.md" file 
<code><pre>      
---
layout: 'base.njk'
permalink: /
title: 'Our Eleventy page'
---

# Hello Price Lab
</pre></code>
    </li>
      
    <li>Permanently delete README.md</li>
    <li>Push changes to repo, Stage Changes, Commit Changes</li>
    <li>Open the Terminal and paste $ <code>npm run start</code></li>
    <li>Hit Enter and it will run the start script</li>
    <li>Open the <a href="http://localhost:8080/">http://localhost:8080/</a> in a new browser tab</li>
    <li>Paste the following code to the <code><head></code> of base.njk 
      <code><pre>
      <link rel="stylesheet" type="text/css" href="{{ 'static/css/main.css' | url }}" media="screen" />
        </pre></code>
    </li>
    <li>Add this code to main.scss 
    <code><pre>
    h1 {
    color: green;
    background-color: black;
    text-align: center;
    padding: 50px;
  }
    </pre></code>
    </li>
    <li>Refresh Local host page and see CSS changes</li>
  </ol>


<h2>GitHub Pages</h2>
  <ol>
    <li>Create new .gitignore file and paste the following code: 
      <code><pre>
      # Dependencies
/node_modules

# Misc
/public

# Intellij
/.idea

# Sass
.sass-cache/
*.css.map
*.sass.map
*.scss.map

# Visual Studio Code
/.vscode
.history 
      </pre></code>
    </li>
    <li>Then go to GitHub repository Settings>Pages in left sidebar</li>
    <li>Click the Branch none drop menu and switch to main and then hit "Save"</li>
    <li>By default, GitHub pages utilizes Jekyll to generate your website. However, in our case, we’re using Eleventy, so we need to notify GitHub Pages about this. To achieve this, make an empty file named .nojekyll and place it in the root directory.</li>
    <li>Then, create a .github folder in the root directory and within that folder, create another folder named workflows.</li>
    <li>Create a build.yml file in workflows and paste this code name: 
      <code><pre>
      Build PR

on:
  pull_request:
    branches: [‘main’]

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: ['20']

    steps:
      - uses: actions/checkout@v4

      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'

      - name: Install packages
        run: npm ci

      - name: Run npm build
        run: npm run build
      </pre></code>
    </li>
    <li>Create a build-and-deploy.yml file in workflows and paste this code name: 
      <code><pre>
      Build and Deploy

on:
  push:
    branches: [‘main’]

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: ['20']

    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4

      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'

      - name: Install packages
        run: npm ci

      - name: Run npm build
        run: npm run build:prod

      - name: Deploy to gh-pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }}
      </pre></code>
    </li>
    <li>Control+C to stop current terminal command.</li>
    <li>Generate your deploy key with the following command in the Terminal $ <code>ssh-keygen -t rsa -b 4096 -C "$(git config user.email)" -f gh-pages -N ""</code></li>
    <li>You will get 2 files: gh-pages.pub is a public key and gh-pages is a private key</li>
    <li>Now go to Repository Settings>Deploy Keys and select the green button "add deploy key"</li>
    <li>give it the title Public key of ACTIONS_DEPLOY_KEY, copy and paste your public key (gh-pages.pub) with the Allow write access checked </li>
    <li>Then go to Secrets and Variables>Actions> and select the green button "New repository secret"</li>
    <li>Name your private key ACTIONS_DEPLOY_KEY and copy and paste your private key (gh-pages) and hit the green "Add secret" button</li>
    <li>Then delete gh-pages and gh-pages.pub from your Explorer</li>
    <li>Add more scripts to package.json file (be sure to add a comma after every script and check indentation) 
      <code><pre>
      "build:sass:prod": "sass src/static/scss:public/static/css --style compressed",
      "build:eleventy:prod": "ELEVENTY_ENV=production eleventy",
      "build:prod": "npm run build:eleventy:prod & npm run build:sass:prod"
      </pre></code>
    </li>
    <li>Then paste the following commands to terminal
      <code><pre>
git add .
git commit -m "build and deploy"
git push
    </pre></code>
    </li>
    <li>Go to your GitHub repository and click on the Actions tab at the top. You’ll usually find the Build & Deploy workflow running, followed by the pages-build-deployment workflow which deploys the website to GitHub Pages once the first one is completed</li>

    <li>Once the Build & Deploy workflow runs, a new branch named gh-pages is automatically generated. This branch will contain the output of your Eleventy site. To ensure the website can be hosted correctly, we must notify GitHub Pages. Go to the Settings tab, choose Pages from the menu on the left, switch the branch for your GitHub Pages site to gh-pages, and click save.</li>
</ol>
</body>
</html>
